if(typeof LP=="undefined"){window.LP={}}(function(c){LP.Course=c.extend(LP.Course||{},{finish:function(f,g){LP.$Course&&LP.$Course.finishCourse({data:f,success:g})}});var d=function(f){this.model=new d.Model(f);this.view=new d.View({model:this.model})},e=Backbone.Model.extend({initialize:function(){this.on("change:content",this._changeContent)},_changeContent:function(){LP.Hook.doAction("learn_press_update_item_content",this)},request:function(f){var g=this;if(!this.get("url")){return false}alert();f=c.extend({context:null,callback:null},f||{});LP.ajax({url:this.get("url"),action:"load-item",data:c.extend({format:"html"},this.toJSON()),dataType:"html",success:function(h){LP.Hook.doAction("learn_press_course_item_loaded",h,g);h=LP.Hook.applyFilters("learn_press_course_item_content",h,g);c.isFunction(f.callback)&&f.callback.call(f.context,h,g)}});return this},complete:function(f){var g=this;f=c.extend({context:null,callback:null,format:"json"},this.toJSON(),f||{});var h={};_.forEach(f,function(j,i){if((c.inArray(i,["content","current","title","url"])==-1)&&!c.isFunction(j)){h[i]=j}});LP.ajax({url:this.get("url"),action:"complete-item",data:h,dataType:"json",success:function(i){LP.Hook.doAction("learn_press_course_item_completed",i,g);i=LP.Hook.applyFilters("learn_press_course_item_complete_response",i,g);c.isFunction(f.callback)&&f.callback.call(f.context,i,g)}})},_toJSON:function(){var f=e.__super__.toJSON.apply(this,arguments);console.log(f);alert()}}),b=Backbone.Collection.extend({model:e,initialize:function(){this.on("add",function(f){})}});d.View=Backbone.View.extend({el:".course-summary",itemEl:null,events:{"click .button-load-item":"_loadItem","click .button-complete-item":"_completeItem","click .section-header":"_toggleSection"},currentItem:null,initialize:function(){var f=this.$(".course-item");_.bindAll(this,"updateItemContent");this.itemEl=this.$("#learn-press-content-item");this.model.items.forEach(function(h,g){h.course=this;h.$el=f.filter(".course-item-"+h.get("id"))},this);this._initHooks();if(this.$(".course-item.item-current").length){this.viewItem(this.$(".course-item.item-current .button-load-item").data("id"),{content:this.itemEl.html()})}LP.log(this.model.get("results"))},_initHooks:function(){LP.Hook.addAction("learn_press_update_item_content",this.updateItemContent)},_loadItem:function(g){g.preventDefault();var f=this,h=c(g.target).data("id");alert("xxxxxxxxxxxxxx");this.currentItem=this.model.getItem(h).request({context:this,item:this.currentItem,callback:function(i){f.viewItem(h,{content:c(i).html()})}})},_completeItem:function(i){var f=this,g=c(i.target),h=g.data("security");this.currentItem.complete({security:h,course_id:this.model.get("id"),callback:function(j,k){if(j.result=="success"){k.$el.removeClass("item-started").addClass("item-completed focus off");_.delay(function(l){l.$el.removeClass("focus off")},3000,k);f.$(".learn-press-course-results-progress").replaceWith(c(j.html))}}})},_toggleSection:function(h){var f=c(h.target).closest(".section-header"),g=f.siblings("ul.section-content");g.slideToggle()},updateItemContent:function(f){this.itemEl.html(f.get("content"))},viewItem:function(h,f){var g=this.model.getItem(h);if(g){g.set(f);g.set("current",true)}this.itemEl.show();this.currentItem=g;this.$('.course-item [data-id="'+g.get("id")+'"]').parent().addClass("item-current item-has-status").siblings(".item-current").removeClass("item-current");LP.setUrl(g.get("url"));return g}});d.Model=Backbone.Model.extend({items:null,initialize:function(){LP.log("Course.Model.initialize");this.createItems()},createItems:function(){this.items=new b();this.items.add(this.get("items"))},getItem:function(f){return c.isPlainObject(f)?this.items.findWhere(f):this.items.findWhere({id:f})},getItems:function(f){return typeof f=="undefined"?this.items:this.items.where(f)},getCurrent:function(){}});LP.Course=d;LP.$Course=new d(LP_Course_Params);return;var a=window.LP_View_Course=Backbone.View.extend({$doc:null,$body:null,courseItems:null,courseItemsView:null,el:".course-summary",events:{"click #learn-press-finish-course":"_finishCourse"},initialize:function(f){var h=parseInt(c(".course-item.item-current").find(">a").attr("data-id")),g=null;if(h){c('[id="learn-press-course-lesson"]').html("")}this.courseItems=new c.LP_Course_Item.Collection();this.courseItemsView=new c.LP_Course_Item_List_View({model:this.courseItems});if(h){this.courseItems.loadItem(h)}_.bindAll(this,"_finishCourse","_sanitizeProgress","completeLesson");this.$doc=c(document);this.$body=c(document.body);LP.Hook.addFilter("learn_press_before_load_item",function(k){LP.MessageBox.blockUI();if(k.model.get("type")=="lp_quiz"){var l=LP.Hook.applyFilters("learn_press_course_item_redirect_url",c(".course-item-"+k.model.get("id")+" a").prop("href"),k);if(l!==false){var j=window.open(l,"_blank");try{j.focus()}catch(i){}}}return true});LP.Hook.addAction("learn_press_item_content_loaded",this.itemLoaded).addAction("learn_press_user_completed_lesson",this.completeLesson).addAction("learn_press_user_passed_course_condition",function(){});this._sanitizeProgress()},itemLoaded:function(f,g){LP.toElement("#learn-press-course-lesson-heading");LP.MessageBox.hide()},completeLesson:function(f,g){if(f&&f.result=="success"){var h=this.$(".complete-lesson-button").addClass("completed").prop("disabled",true).html(f.button_text);c(".course-item-"+f.id).addClass("item-completed");if(f.course_result){if(f.can_finish){this.$("#learn-press-finish-course").removeClass("hide-if-js");LP.Hook.doAction("learn_press_user_passed_course_condition",f,this,g)}if(f.message){c(f.message).insertBefore(h)}this.updateProgress(f)}}},updateProgress:function(f){c(".lp-course-progress").attr({"data-value":f.course_result});this._sanitizeProgress()},_loadLesson:function(f){this.loadLesson(c(f.target).attr("href"))},loadLesson:function(h,f){var g=this;LP.Hook.doAction("learn_press_before_load_lesson",h,this);f=c.extend({success:function(){return true},error:function(){}},f||{});c.ajax({url:h,success:function(l){var m=true;c.isFunction(f.success)&&(m=f.success.call(this,l));if(m===true){var i=c(l),k=i.find("#learn-press-course-lesson-summary"),j=i.find("#learn-press-course-lesson-heading");c("title").html(i.filter("title").text());c("#learn-press-course-description-heading, #learn-press-course-lesson-heading").replaceWith(j);c("#learn-press-course-description, #learn-press-course-lesson-summary").replaceWith(k);LP.Hook.doAction("learn_press_load_lesson_completed",h,g);LP.Hook.doAction("learn_press_lesson_content_loaded",i,this)}},error:function(){LP.MessageBox.hide()}})},_finishCourse:function(i){var f=this,h=c(i.target),g=h.data();g=LP.Hook.applyFilters("learn_press_user_finish_course_data",g);if(g&&g.id){h.prop("disabled",true);this.finishCourse({data:g,success:function(j){LP.Hook.applyFilters("learn_press_finish_course_params",j);if(j&&j.result=="success"){f.$("#learn-press-finish-course, .complete-lesson-button").remove();LP.Hook.doAction("learn_press_finish_course",j)}if(j.message){LP.alert(j.message,function(){if(j.redirect){LP.reload(j.redirect)}})}else{if(j.redirect){LP.reload(j.redirect)}}}})}},finishCourse:function(f){f=f||{};var g=function(k){if(k){LP.doAjax({prefix:"",data:j,success:i})}},i=function(k){c.isFunction(f.success)&&f.success.call(h,k)},h=this,j=c.extend({"lp-ajax":"finish_course"},f.data||{});LP.confirm(single_course_localize.confirm_finish_course,g)},_sanitizeProgress:function(){var h=c(".lp-course-progress"),f=c(".lp-progress-value",h),i=c(".lp-passing-conditional",h),j=parseFloat(h.attr("data-value")),g=parseFloat(h.attr("data-passing-condition")),k=function(){var l=parseInt(f.css("width")),m=parseInt(i.css("left"));if(j>=g){h.addClass("passed")}};f.css("width",j+"%").find("span span").html(j);setTimeout(k,500)}});c(document).ready(function(){LP.$Course=new a();LP.Hook.addAction("learn_press_item_content_loaded",function(g,f){setTimeout(function(){try{window.wp.mediaelement.initialize()}catch(h){}},300)})})})(jQuery);