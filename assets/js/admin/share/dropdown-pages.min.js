!function(e){function t(t,i){this.options=e.extend({ID:"",name:"Add new page"},i||{});const a=e(t),n=a.find("select"),s=a.find(".list-pages-wrapper"),o=a.find(".quick-add-page-actions"),r=a.find(".quick-add-page-inline");n.on("change",(function(){o.addClass("hide-if-js"),"add_new_page"===this.value?(s.addClass("hide-if-js"),r.removeClass("hide-if-js").find("input").trigger("focus").val("")):parseInt(this.value)&&(o.find("a.edit-page").attr("href","post.php?post="+this.value+"&action=edit"),o.find("a.view-page").attr("href",lpGlobalSettings.siteurl+"?page_id="+this.value),o.removeClass("hide-if-js"),n.attr("data-selected",this.value))})),n.css("width",n.width()+50).find("option").each((function(){e(this).html(e(this).html().replace(/&nbsp;&nbsp;&nbsp;/g,""))})),n.select2({allowClear:!0}),n.on("select2:select",(function(e){e.params.data})),a.on("click",".quick-add-page-inline button",(function(){const t=e(this),i=r.find("input"),a=i.val();if(!a)return alert("Please enter the name of page"),void i.trigger("focus");t.prop("disabled",!0);const o=t.closest("tr");let d="";o.length&&(d=o.find(".field_name").attr("name")),e.ajax({url:lpGlobalSettings.ajax,data:{action:"learnpress_create_page",page_name:a,field_name:d},type:"post",dataType:"html",success(i){(i=LP.parseJSON(i)).page?(!function(t){const i=e('<option value="'+t.ID+'">'+t.name+"</option>"),a=e.inArray(t.ID+"",t.positions);e(".learn-press-dropdown-pages select").each((function(){const n=e(this),s=i.clone();0==a?e("option",n).each((function(){if(parseInt(e(this).val()))return s.insertBefore(e(this)),!1})):a==t.positions.length-1?n.append(s):s.insertAfter(e('option[value="'+t.positions[a-1]+'"]',n))}))}({ID:i.page.ID,name:i.page.post_title,positions:i.positions}),n.val(i.page.ID).trigger("focus"),n.val(i.page.ID).trigger("change"),r.addClass("hide-if-js")):i.error&&alert(i.error),t.prop("disabled",!1),s.removeClass("hide-if-js")}})})).on("click",".quick-add-page-inline a",(function(e){e.preventDefault(),r.addClass("hide-if-js"),n.val(n.attr("data-selected")+"").removeAttr("disabled").trigger("change"),s.removeClass("hide-if-js")})).on("click",".button-quick-add-page",(function(e){n.val("add_new_page").trigger("change")})).on("keypress keydown",'.quick-add-page-inline input[type="text"]',(function(t){"Enter"==t.key&&"keypress"==t.type?(t.preventDefault(),e(this).siblings("button").trigger("click")):"Escape"==t.key&&"keydown"==t.type&&e(this).siblings("a").trigger("click")}))}e.fn.LP("DropdownPages",(function(){return e.each(this,(function(){let i=e(this).data("DropdownPages");return i||(i=new t(this,{}),e(this).data("DropdownPages",i)),i}))}))}(jQuery);